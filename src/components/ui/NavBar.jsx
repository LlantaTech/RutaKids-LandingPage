import { useEffect, useRef, useState } from "react";
import { gsap } from "gsap";
import Lenis from "@studio-freight/lenis";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import { useTranslation } from 'react-i18next';
import { FaBars, FaTimes } from "react-icons/fa";
import { ScrollToPlugin } from "gsap/ScrollToPlugin";


export default function NavBar({ sectionRefs }) {
  const navBar = useRef(null);
  const cta = useRef(null);
  const { t } = useTranslation('navbar');

  const [menuOpen, setMenuOpen] = useState(false);
  const toggleMenu = () => setMenuOpen(!menuOpen);

  gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

  const scrollToSection = (id) => {
    const target = document.getElementById(id);
    if (target) {
      gsap.to(window, {
        duration: 1.2,
        scrollTo: { y: target, offsetY: 70 },
        ease: "power2.inOut",
      });
      setMenuOpen(false); // cierra el menú móvil si está abierto
    }
  };


  useEffect(() => {
    const lenis = new Lenis();
    function raf(time) {
      lenis.raf(time);
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);
  }, []);

  useEffect(() => {
    gsap.to(navBar.current, {
      y: 0,
      duration: 2,
      delay: 0.5,
      ease: "power4.inOut",
    });
  }, []);

  const navItems = [
    { id: "hero", label: t('home') },
    { id: "¿Por_qué_elegirnos?", label: t('benefits') },
    { id: "¿Cómo_funciona?", label: t('features') },
    { id: "padres", label: t('parents') },
    { id: "colegios", label: t('schools') },
    { id: "contactanos", label: t('contact') },


  ];

  return (
      <header
          ref={navBar}
          className="fixed top-0 z-50 w-full -translate-y-full flex items-center justify-between bg-white px-5 py-3 shadow-md"
      >
        {/* Logo */}
        <a href="#hero" aria-label="Logo" className="flex items-center gap-2">
          <svg
              width="36"
              height="36"
              viewBox="0 0 150 150"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              className="w-8 h-8 md:w-10 md:h-10"
          >
            <path
                d="M47.4187 14.1875C48.0937 13.875 48.7812 13.575 49.4812 13.2875L51.6375 12.4438C61.9063 8.65005 75.4625 6.9563 98.3875 12.6875C108.631 15.25 116.325 23.2125 121.312 32.1875C127.575 43.4625 131.25 58.6125 131.25 75C131.25 91.3938 127.575 106.538 121.312 117.813C116.319 126.788 108.625 134.75 98.3875 137.313C75.4625 143.044 61.9063 141.35 51.6375 137.563L49.4875 136.713C48.7952 136.426 48.1076 136.128 47.425 135.819C38.6937 131.863 31.5625 123.481 26.6625 113.081C21.7062 102.563 18.75 89.4313 18.75 75C18.75 60.5688 21.7062 47.4375 26.6625 36.9188C31.5625 26.5188 38.6875 18.1375 47.4187 14.1875ZM93.75 25C88.4188 25 82.2812 28.9625 77.1187 38.2625C72.0625 47.35 68.75 60.325 68.75 75C68.75 89.675 72.0625 102.65 77.1187 111.738C82.2812 121.038 88.4188 125 93.75 125C99.0812 125 105.219 121.038 110.381 111.738C115.437 102.65 118.75 89.675 118.75 75C118.75 60.325 115.437 47.35 110.381 38.2625C105.219 28.9625 99.0812 25 93.75 25ZM93.75 53.125C98.1625 53.125 101.312 56.6188 103.175 60.3438C105.131 64.2563 106.25 69.4438 106.25 75C106.25 80.5563 105.125 85.7438 103.175 89.6563C101.312 93.3813 98.1625 96.875 93.75 96.875C89.3375 96.875 86.1875 93.3813 84.325 89.6563C82.375 85.7438 81.25 80.5563 81.25 75C81.25 69.4438 82.375 64.2563 84.325 60.3438C86.1875 56.625 89.3375 53.125 93.75 53.125Z"
                fill="#2563EB"
            />
          </svg>

          <svg width="120" height="60" viewBox="0 0 819 189" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M68.4998 114L78.0248 13.05H100.225L92.5748 92.4H126.475L124.525 114H68.4998ZM139.545 114L149.07 13.05H171.27L163.62 92.4H197.52L195.57 114H139.545ZM232.265 116.625C226.165 116.625 221.065 115.5 216.965 113.25C212.915 110.95 209.965 107.875 208.115 104.025C206.265 100.175 205.59 95.925 206.09 91.275C206.39 86.825 207.765 83 210.215 79.8C212.665 76.6 216.14 74.125 220.64 72.375C225.14 70.625 230.59 69.75 236.99 69.75C240.29 69.75 243.215 69.95 245.765 70.35C248.365 70.7 250.99 71.05 253.64 71.4L254.165 66.525C254.565 63.025 254.265 60.275 253.265 58.275C252.315 56.275 249.99 55.275 246.29 55.275C243.94 55.275 241.99 55.675 240.44 56.475C238.94 57.225 237.765 58.225 236.915 59.475C236.115 60.675 235.59 62 235.34 63.45H211.265C211.815 57.45 213.615 52.55 216.665 48.75C219.765 44.9 223.84 42.075 228.89 40.275C233.99 38.425 239.79 37.5 246.29 37.5C257.54 37.5 265.615 40.075 270.515 45.225C275.465 50.325 277.49 57.75 276.59 67.5L272.24 114H252.815C252.665 112.8 252.54 111.575 252.44 110.325C252.34 109.075 252.19 107.825 251.99 106.575C249.34 109.775 246.69 112.25 244.04 114C241.39 115.75 237.465 116.625 232.265 116.625ZM239.84 97.95C242.34 97.95 244.365 97.425 245.915 96.375C247.465 95.325 248.715 93.975 249.665 92.325C250.665 90.675 251.515 88.95 252.215 87.15C250.765 86.75 248.915 86.375 246.665 86.025C244.415 85.625 242.34 85.425 240.44 85.425C237.64 85.425 235.19 85.925 233.09 86.925C231.04 87.925 229.965 89.375 229.865 91.275C229.765 93.325 230.765 94.95 232.865 96.15C234.965 97.35 237.29 97.95 239.84 97.95ZM293.725 114L300.775 39.675H320.125L321.325 50.325C324.225 45.875 327.45 42.625 331 40.575C334.6 38.525 338.375 37.5 342.325 37.5C348.075 37.5 352.625 38.95 355.975 41.85C359.325 44.7 361.625 48.65 362.875 53.7C364.125 58.7 364.475 64.425 363.925 70.875L360.025 114H337.3L341.2 70.875C341.7 67.225 341.25 64.5 339.85 62.7C338.5 60.85 336.65 59.925 334.3 59.925C330.85 59.925 327.6 61.675 324.55 65.175C321.5 68.675 319.55 74.65 318.7 83.1L315.925 114H293.725ZM404.954 116.625C400.754 116.625 396.904 115.75 393.404 114C389.904 112.2 387.204 109.475 385.304 105.825C383.454 102.175 382.779 97.5 383.279 91.8L387.029 51.525L390.104 55.5H379.154L380.579 39.675H391.829L388.154 43.05L390.029 21.375H412.229L410.354 43.05L407.279 39.675H425.579L424.079 55.5H405.704L409.379 51.525L405.854 90.675C405.654 93.025 405.979 94.725 406.829 95.775C407.729 96.775 409.304 97.275 411.554 97.275C412.404 97.275 413.504 97.125 414.854 96.825C416.204 96.525 417.879 96 419.879 95.25L421.604 112.575C418.854 113.575 416.179 114.5 413.579 115.35C411.029 116.2 408.154 116.625 404.954 116.625ZM458.876 116.625C452.776 116.625 447.676 115.5 443.576 113.25C439.526 110.95 436.576 107.875 434.726 104.025C432.876 100.175 432.201 95.925 432.701 91.275C433.001 86.825 434.376 83 436.826 79.8C439.276 76.6 442.751 74.125 447.251 72.375C451.751 70.625 457.201 69.75 463.601 69.75C466.901 69.75 469.826 69.95 472.376 70.35C474.976 70.7 477.601 71.05 480.251 71.4L480.776 66.525C481.176 63.025 480.876 60.275 479.876 58.275C478.926 56.275 476.601 55.275 472.901 55.275C470.551 55.275 468.601 55.675 467.051 56.475C465.551 57.225 464.376 58.225 463.526 59.475C462.726 60.675 462.201 62 461.951 63.45H437.876C438.426 57.45 440.226 52.55 443.276 48.75C446.376 44.9 450.451 42.075 455.501 40.275C460.601 38.425 466.401 37.5 472.901 37.5C484.151 37.5 492.226 40.075 497.126 45.225C502.076 50.325 504.101 57.75 503.201 67.5L498.851 114H479.426C479.276 112.8 479.151 111.575 479.051 110.325C478.951 109.075 478.801 107.825 478.601 106.575C475.951 109.775 473.301 112.25 470.651 114C468.001 115.75 464.076 116.625 458.876 116.625ZM466.451 97.95C468.951 97.95 470.976 97.425 472.526 96.375C474.076 95.325 475.326 93.975 476.276 92.325C477.276 90.675 478.126 88.95 478.826 87.15C477.376 86.75 475.526 86.375 473.276 86.025C471.026 85.625 468.951 85.425 467.051 85.425C464.251 85.425 461.801 85.925 459.701 86.925C457.651 87.925 456.576 89.375 456.476 91.275C456.376 93.325 457.376 94.95 459.476 96.15C461.576 97.35 463.901 97.95 466.451 97.95ZM523.924 114L531.724 34.425H505.174L507.199 13.05H582.424L580.399 34.425H553.924L546.124 114H523.924ZM601.75 116.625C596.05 116.625 590.875 114.925 586.225 111.525C581.575 108.075 577.975 103.35 575.425 97.35C572.925 91.3 572.05 84.4 572.8 76.65C573.55 68.45 575.725 61.45 579.325 55.65C582.975 49.8 587.425 45.325 592.675 42.225C597.925 39.075 603.425 37.5 609.175 37.5C614.675 37.5 619.275 38.675 622.975 41.025C626.675 43.325 629.575 46.425 631.675 50.325C633.775 54.225 635.15 58.6 635.8 63.45C636.45 68.25 636.425 73.15 635.725 78.15C635.475 79.2 635.225 80.1 634.975 80.85C634.775 81.6 634.575 82.425 634.375 83.325H590.65L594.325 80.175C593.725 83.475 593.675 86.375 594.175 88.875C594.725 91.375 595.775 93.325 597.325 94.725C598.925 96.125 601 96.825 603.55 96.825C605.2 96.825 606.75 96.4 608.2 95.55C609.7 94.65 610.825 93.25 611.575 91.35H633.775C632.725 95.95 630.7 100.175 627.7 104.025C624.75 107.825 621.05 110.875 616.6 113.175C612.2 115.475 607.25 116.625 601.75 116.625ZM595.225 71.7L592.075 68.475H619.15L615.475 71.7C615.825 69.45 615.875 67.225 615.625 65.025C615.425 62.775 614.675 60.925 613.375 59.475C612.125 57.975 610.125 57.225 607.375 57.225C605.175 57.225 603.2 57.8 601.45 58.95C599.7 60.1 598.275 61.775 597.175 63.975C596.125 66.125 595.475 68.7 595.225 71.7ZM675.796 116.625C670.146 116.625 664.971 114.975 660.271 111.675C655.621 108.325 652.046 103.675 649.546 97.725C647.046 91.775 646.171 84.875 646.921 77.025C647.671 68.375 649.846 61.125 653.446 55.275C657.096 49.425 661.571 45 666.871 42C672.171 39 677.696 37.5 683.446 37.5C688.446 37.5 692.696 38.45 696.196 40.35C699.746 42.25 702.596 44.75 704.746 47.85C706.946 50.9 708.471 54.25 709.321 57.9C710.221 61.55 710.521 65.1 710.221 68.55L687.571 68.325C687.471 66.325 686.996 64.425 686.146 62.625C685.296 60.825 683.621 59.925 681.121 59.925C679.521 59.925 677.871 60.425 676.171 61.425C674.471 62.425 672.971 64.175 671.671 66.675C670.421 69.125 669.571 72.575 669.121 77.025C668.721 81.375 668.896 84.775 669.646 87.225C670.446 89.675 671.571 91.4 673.021 92.4C674.471 93.4 675.946 93.9 677.446 93.9C680.696 93.9 682.896 93.125 684.046 91.575C685.196 90.025 685.971 88.125 686.371 85.875H708.496C707.946 91.225 706.396 96.25 703.846 100.95C701.296 105.6 697.696 109.375 693.046 112.275C688.396 115.175 682.646 116.625 675.796 116.625ZM722.992 114L732.592 10.2H755.167L751.267 49.575C754.167 45.275 757.342 42.2 760.792 40.35C764.292 38.45 767.917 37.5 771.667 37.5C777.417 37.5 781.967 38.95 785.317 41.85C788.667 44.7 790.942 48.65 792.142 53.7C793.392 58.7 793.742 64.425 793.192 70.875L789.292 114H766.642L770.542 70.875C771.042 67.175 770.592 64.425 769.192 62.625C767.792 60.825 765.917 59.925 763.567 59.925C761.867 59.925 760.067 60.375 758.167 61.275C756.317 62.125 754.567 63.65 752.917 65.85C751.317 68.05 750.017 71.15 749.017 75.15L745.192 114H722.992Z"
                fill="#2563EB"/>
            <path d="M64 172.5V138.5H756.5L64 172.5Z" fill="#2563EB" stroke="#2563EB"/>
          </svg>

        </a>


        {/* Desktop Nav */}
        <nav className="hidden lg:flex gap-6 items-center justify-center font-medium text-gray-800 text-[18px]">
          {navItems.map((item) => (
              <button
                  key={item.id}
                  onClick={() => scrollToSection(item.id)}
                  className="relative group cursor-pointer bg-transparent border-none text-inherit"
              >
                <span>{item.label}</span>
                <span className="absolute bottom-0 left-0 h-[2px] w-0 rounded-full bg-blue-600 transition-all duration-300 group-hover:w-full"></span>
              </button>
          ))}
        </nav>


        {/* CTA button */}
        <a
            ref={cta}
            href="#Login"
            className="ml-4 px-4 py-2 rounded-full bg-blue-600 text-white hover:bg-transparent hover:text-blue-600 border border-blue-600 transition hidden lg:inline-block"
        >
          {t('login')}
        </a>

        {/* Mobile Menu Toggle */}
        <button className="lg:hidden text-2xl text-gray-700" onClick={toggleMenu}>
          {menuOpen ? <FaTimes /> : <FaBars />}
        </button>

        {/* Mobile Nav */}
        {menuOpen && (
            <div className="absolute top-full left-0 w-full bg-white shadow-lg py-4 px-6 space-y-4 lg:hidden">
              {navItems.map(item => (
                  <a key={item.id} href={`#${item.id}`} onClick={() => setMenuOpen(false)} className="block text-gray-800">
                    {item.label}
                  </a>
              ))}
              <a
                  href="#Login"
                  onClick={() => setMenuOpen(false)}
                  className="block bg-blue-600 text-white text-center py-2 rounded-full hover:bg-blue-700"
              >
                {t('login')}
              </a>
            </div>
        )}
      </header>
  );
}
